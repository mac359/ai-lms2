{% extends 'base.html' %}
{% block title %}{{ course.title }} - Course Details{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Course Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient-primary text-white">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h1 class="display-5 mb-2">
                                <i class="fas fa-book me-3"></i>{{ course.title }}
                            </h1>
                            <p class="lead mb-3">{{ course.description }}</p>
                            <div class="d-flex flex-wrap gap-3">
                                {% if course.instructor and course.instructor.instructor_profile %}
                                <span class="badge bg-light text-dark">
                                    <i class="fas fa-chalkboard-teacher me-1"></i>
                                    {{ course.instructor.instructor_profile.name }}
                                </span>
                                {% endif %}
                                {% if course.category %}
                                <span class="badge bg-light text-dark">
                                    <i class="fas fa-tag me-1"></i>{{ course.category|title }}
                                </span>
                                {% endif %}
                                {% if course.level %}
                                <span class="badge bg-light text-dark">
                                    <i class="fas fa-signal me-1"></i>{{ course.level|title }}
                                </span>
                                {% endif %}
                                {% if course.code %}
                                <span class="badge bg-light text-dark">
                                    <i class="fas fa-hashtag me-1"></i>{{ course.code }}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="d-flex flex-column align-items-end">
                                <div class="mb-3">
                                    <h4 class="mb-0">{{ course.students|length if course.students else 0 }}</h4>
                                    <small>Enrolled Students</small>
                                </div>
                                <div class="progress mb-2" style="width: 150px; height: 8px;">
                                    <div class="progress-bar bg-light" role="progressbar" style="width: 75%"></div>
                                </div>
                                <small>Course Progress: 75%</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Course Navigation Tabs -->
    <div class="row mb-4">
        <div class="col-12">
            <ul class="nav nav-tabs" id="courseTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">
                        <i class="fas fa-home me-2"></i>Overview
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="content-tab" data-bs-toggle="tab" data-bs-target="#content" type="button" role="tab">
                        <i class="fas fa-book-open me-2"></i>Content
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="assignments-tab" data-bs-toggle="tab" data-bs-target="#assignments" type="button" role="tab">
                        <i class="fas fa-tasks me-2"></i>Assignments
                        {% if assignments|length > 0 %}
                        <span class="badge bg-danger ms-1">{{ assignments|length }}</span>
                        {% endif %}
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="quizzes-tab" data-bs-toggle="tab" data-bs-target="#quizzes" type="button" role="tab">
                        <i class="fas fa-question-circle me-2"></i>Quizzes
                        {% if quizzes|length > 0 %}
                        <span class="badge bg-info ms-1">{{ quizzes|length }}</span>
                        {% endif %}
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="meetings-tab" data-bs-toggle="tab" data-bs-target="#meetings" type="button" role="tab">
                        <i class="fas fa-video me-2"></i>Meetings
                        {% if meetings|length > 0 %}
                        <span class="badge bg-success ms-1">{{ meetings|length }}</span>
                        {% endif %}
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="resources-tab" data-bs-toggle="tab" data-bs-target="#resources" type="button" role="tab">
                        <i class="fas fa-download me-2"></i>Resources
                        {% if attachments|length > 0 %}
                        <span class="badge bg-warning ms-1">{{ attachments|length }}</span>
                        {% endif %}
                    </button>
        </li>
            </ul>
        </div>
    </div>

    <!-- Tab Content -->
    <div class="tab-content" id="courseTabContent">
        <!-- Overview Tab -->
        <div class="tab-pane fade show active" id="overview" role="tabpanel">
            <div class="row">
                <!-- Course Information -->
                <div class="col-lg-8">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-info-circle me-2"></i>Course Information
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <strong>Instructor:</strong>
                                    <p class="mb-1">
                                        {% if course.instructor and course.instructor.instructor_profile %}
                                            {{ course.instructor.instructor_profile.name }}
                                            {% if course.instructor.instructor_profile.department %}
                                                <br><small class="text-muted">{{ course.instructor.instructor_profile.department }}</small>
                                            {% endif %}
                                        {% else %}
                                            {{ course.instructor.email if course.instructor else 'Not assigned' }}
                                        {% endif %}
                                    </p>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <strong>Created:</strong>
                                    <p class="mb-1">{{ course.created_at.strftime('%B %d, %Y') }}</p>
                                </div>
                                {% if course.start_date %}
                                <div class="col-md-6 mb-3">
                                    <strong>Start Date:</strong>
                                    <p class="mb-1">{{ course.start_date.strftime('%B %d, %Y') }}</p>
                                </div>
                                {% endif %}
                                {% if course.end_date %}
                                <div class="col-md-6 mb-3">
                                    <strong>End Date:</strong>
                                    <p class="mb-1">{{ course.end_date.strftime('%B %d, %Y') }}</p>
                                </div>
                                {% endif %}
                                {% if course.meeting_days %}
                                <div class="col-md-6 mb-3">
                                    <strong>Meeting Days:</strong>
                                    <p class="mb-1">
                                        {% set days = course.meeting_days.split(',') %}
                                        {% for day in days %}
                                            <span class="badge bg-primary me-1">{{ day|title }}</span>
                                        {% endfor %}
                                    </p>
                                </div>
                                {% endif %}
                                {% if course.meeting_time %}
                                <div class="col-md-6 mb-3">
                                    <strong>Meeting Time:</strong>
                                    <p class="mb-1">{{ course.meeting_time }}</p>
                                </div>
                                {% endif %}
                            </div>
                            
                            {% if course.syllabus %}
                            <div class="mt-4">
                                <h6>Syllabus</h6>
                                <div class="border rounded p-3 bg-light">
                                    {{ course.syllabus|nl2br }}
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if course.prerequisites %}
                            <div class="mt-4">
                                <h6>Prerequisites</h6>
                                <div class="border rounded p-3 bg-light">
                                    {{ course.prerequisites|nl2br }}
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if course.learning_outcomes %}
                            <div class="mt-4">
                                <h6>Learning Outcomes</h6>
                                <div class="border rounded p-3 bg-light">
                                    {{ course.learning_outcomes|nl2br }}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="col-lg-4">
                    <!-- Quick Stats -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-chart-bar me-2"></i>Your Progress
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-6 mb-3">
                                    <div class="border rounded p-3">
                                        <h4 class="text-primary mb-0">{{ quizzes|length }}</h4>
                                        <small>Total Quizzes</small>
                                    </div>
                                </div>
                                <div class="col-6 mb-3">
                                    <div class="border rounded p-3">
                                        <h4 class="text-success mb-0">{{ assignments|length }}</h4>
                                        <small>Assignments</small>
                                    </div>
                                </div>
                                <div class="col-6 mb-3">
                                    <div class="border rounded p-3">
                                        <h4 class="text-info mb-0">{{ modules|length }}</h4>
                                        <small>Modules</small>
                                    </div>
                                </div>
                                <div class="col-6 mb-3">
                                    <div class="border rounded p-3">
                                        <h4 class="text-warning mb-0">{{ attachments|length }}</h4>
                                        <small>Resources</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Announcements -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-bullhorn me-2"></i>Recent Announcements
                            </h6>
                        </div>
                        <div class="card-body">
                            {% if announcements %}
                                {% for announcement in announcements[:3] %}
                                <div class="mb-3 pb-3 border-bottom">
                                    <h6 class="mb-1">{{ announcement.title }}</h6>
                                    <p class="small text-muted mb-1">{{ announcement.message[:100] }}{% if announcement.message|length > 100 %}...{% endif %}</p>
                                    <small class="text-muted">{{ announcement.created_at.strftime('%b %d, %Y') }}</small>
                                </div>
                                {% endfor %}
                                {% if announcements|length > 3 %}
                                <a href="#announcements" class="btn btn-sm btn-outline-primary">View All</a>
                                {% endif %}
                            {% else %}
                                <p class="text-muted small">No announcements yet.</p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Upcoming Deadlines -->
                    <div class="card">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-clock me-2"></i>Upcoming Deadlines
                            </h6>
                        </div>
                        <div class="card-body">
                            {% set upcoming_items = [] %}
                            {% for assignment in assignments %}
                                {% if assignment.due_date > current_time %}
                                    {% set _ = upcoming_items.append({'type': 'assignment', 'title': assignment.title, 'date': assignment.due_date, 'color': 'warning'}) %}
                                {% endif %}
                            {% endfor %}
                            {% for quiz in quizzes %}
                                {% if quiz.end_time and quiz.end_time > current_time %}
                                    {% set _ = upcoming_items.append({'type': 'quiz', 'title': quiz.title, 'date': quiz.end_time, 'color': 'info'}) %}
                                {% endif %}
                            {% endfor %}
                            
                            {% if upcoming_items %}
                                {% for item in upcoming_items[:5] %}
                                <div class="mb-2">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <small class="text-{{ item.color }}">{{ item.type|title }}</small>
                                            <div class="small">{{ item.title }}</div>
                                        </div>
                                        <small class="text-muted">{{ item.date.strftime('%b %d') }}</small>
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <p class="text-muted small">No upcoming deadlines.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Tab -->
        <div class="tab-pane fade" id="content" role="tabpanel">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-book-open me-2"></i>Course Modules
                            </h5>
                        </div>
                        <div class="card-body">
                            {% if modules %}
                                <div class="accordion" id="modulesAccordion">
                                    {% for module in modules %}
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="module{{ module.id }}">
                                            <button class="accordion-button {% if not loop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ module.id }}">
                                                <div class="d-flex justify-content-between align-items-center w-100 me-3">
                                                    <span>
                                                        <i class="fas fa-folder me-2"></i>
                                                        {{ module.title }}
                                                    </span>
                                                </div>
                                            </button>
                                        </h2>
                                        <div id="collapse{{ module.id }}" class="accordion-collapse collapse {% if loop.first %}show{% endif %}" data-bs-parent="#modulesAccordion">
                                            <div class="accordion-body">
                                                <p>{{ module.description }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="text-center py-5">
                                    <i class="fas fa-book fa-3x text-muted mb-3"></i>
                                    <h5 class="text-muted">No modules available yet</h5>
                                    <p class="text-muted">Course content will be added by your instructor.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Assignments Tab -->
        <div class="tab-pane fade" id="assignments" role="tabpanel">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-tasks me-2"></i>Assignments
                            </h5>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-outline-primary btn-sm active">All</button>
                                <button type="button" class="btn btn-outline-primary btn-sm">Pending</button>
                                <button type="button" class="btn btn-outline-primary btn-sm">Completed</button>
                            </div>
                        </div>
                        <div class="card-body">
                            {% if assignments %}
                                <div class="row">
                                    {% for assignment in assignments %}
                                    <div class="col-md-6 col-lg-4 mb-4">
                                        <div class="card h-100 border-{% if assignment.due_date < current_time %}danger{% elif assignment.due_date < (current_time + timedelta(days=7)) %}warning{% else %}success{% endif %}">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <h6 class="card-title">{{ assignment.title }}</h6>
                                                    <span class="badge bg-{% if assignment.due_date < current_time %}danger{% elif assignment.due_date < (current_time + timedelta(days=7)) %}warning{% else %}success{% endif %}">
                                                        {% if assignment.due_date < current_time %}Overdue
                                                        {% elif assignment.due_date < (current_time + timedelta(days=7)) %}Due Soon
                                                        {% else %}Active{% endif %}
                                                    </span>
                                                </div>
                                                <p class="card-text small">{{ assignment.instructions[:100] }}{% if assignment.instructions|length > 100 %}...{% endif %}</p>
                                                <div class="mb-3">
                                                    <small class="text-muted">
                                                        <i class="fas fa-calendar me-1"></i>
                                                        Due: {{ assignment.due_date.strftime('%b %d, %Y at %I:%M %p') }}
                                                    </small>
                                                    {% if assignment.points %}
                                                    <br><small class="text-muted">
                                                        <i class="fas fa-star me-1"></i>
                                                        {{ assignment.points }} points
                                                    </small>
                                                    {% endif %}
                                                </div>
                                                <div class="d-grid">
                                                    {% set submission = assignment.submissions | selectattr('student_id', 'equalto', current_user.id) | first %}
                                                    {% if not submission and current_user.role == 'student' %}
                                                        <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#submitAssignmentModal{{ assignment.id }}">
                                                            <i class="fas fa-upload me-1"></i>Submit Assignment
                                                        </button>
                                                    {% elif submission %}
                                                        <div class="alert alert-success small mb-2">
                                                            <b>Submitted:</b> {{ submission.submitted_at.strftime('%b %d, %Y %I:%M %p') }}<br>
                                                            <b>Your Answer:</b><br>
                                                            <div class="border rounded p-2 bg-light">{{ submission.comments }}</div>
                                                            {% if submission.grade is not none %}
                                                                <b>Grade:</b> {{ submission.grade }}<br>
                                                                {% if submission.feedback %}<b>Feedback:</b> {{ submission.feedback }}{% endif %}
                                                            {% else %}
                                                                <span class="text-warning">Not graded yet</span>
                                                            {% endif %}
                                                        </div>
                                                    {% endif %}
                                                    {% if current_user.role == 'instructor' %}
                                                        <button class="btn btn-outline-info btn-sm" data-bs-toggle="modal" data-bs-target="#viewSubmissionsModal{{ assignment.id }}">
                                                            <i class="fas fa-eye me-1"></i>View Submissions
                                                        </button>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
        {% endfor %}
                                </div>
                            {% else %}
                                <div class="text-center py-5">
                                    <i class="fas fa-tasks fa-3x text-muted mb-3"></i>
                                    <h5 class="text-muted">No assignments available</h5>
                                    <p class="text-muted">Assignments will be posted by your instructor.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <!-- After the assignments grid, output all modals for assignments -->
            {% for assignment in assignments %}
                {% set submission = assignment.submissions | selectattr('student_id', 'equalto', current_user.id) | first %}
                {% if not submission and current_user.role == 'student' %}
                    <!-- Modal for assignment submission -->
                    <div class="modal fade" id="submitAssignmentModal{{ assignment.id }}" tabindex="-1" aria-labelledby="submitAssignmentModalLabel{{ assignment.id }}" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <form method="POST" action="{{ url_for('student.submit_assignment', course_id=course.id, assignment_id=assignment.id) }}">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <div class="modal-header">
                              <h5 class="modal-title" id="submitAssignmentModalLabel{{ assignment.id }}">Submit Assignment: {{ assignment.title }}</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                              <div class="mb-3">
                                <label for="comments{{ assignment.id }}" class="form-label">Your Answer</label>
                                <textarea class="form-control" id="comments{{ assignment.id }}" name="comments" rows="6" required></textarea>
                              </div>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                              <button type="submit" class="btn btn-primary">Submit</button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                {% endif %}
                {% if current_user.role == 'instructor' %}
                    <!-- Modal for instructor to view and grade submissions -->
                    <div class="modal fade" id="viewSubmissionsModal{{ assignment.id }}" tabindex="-1" aria-labelledby="viewSubmissionsModalLabel{{ assignment.id }}" aria-hidden="true">
                      <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="viewSubmissionsModalLabel{{ assignment.id }}">Submissions for: {{ assignment.title }}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                            {% for sub in assignment.submissions %}
                              <div class="mb-4 border-bottom pb-2">
                                <b>Student:</b> {{ sub.student.email if sub.student else 'Unknown' }}<br>
                                <b>Submitted:</b> {{ sub.submitted_at.strftime('%b %d, %Y %I:%M %p') }}<br>
                                <b>Answer:</b>
                                <div class="border rounded p-2 bg-light">{{ sub.comments }}</div>
                                <form method="POST" action="{{ url_for('instructor.grade_assignment', course_id=course.id, assignment_id=assignment.id, submission_id=sub.id) }}" class="row g-2 align-items-center mt-2">
                                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                  <div class="col-auto">
                                    <label class="form-label mb-0" for="grade{{ sub.id }}">Grade</label>
                                    <input id="grade{{ sub.id }}" type="number" step="0.1" min="0" max="100" class="form-control form-control-sm" name="grade" value="{{ sub.grade or '' }}" placeholder="Grade" required>
                                  </div>
                                  <div class="col-auto">
                                    <label class="form-label mb-0" for="feedback{{ sub.id }}">Feedback</label>
                                    <input id="feedback{{ sub.id }}" type="text" class="form-control form-control-sm" name="feedback" value="{{ sub.feedback or '' }}" placeholder="Feedback">
                                  </div>
                                  <div class="col-auto align-self-end">
                                    <button type="submit" class="btn btn-success btn-sm">Save Grade</button>
                                  </div>
                                </form>
                              </div>
    {% else %}
                              <div class="text-muted">No submissions yet.</div>
                            {% endfor %}
                          </div>
                        </div>
                      </div>
                    </div>
    {% endif %}
            {% endfor %}
        </div>

        <!-- Quizzes Tab -->
        <div class="tab-pane fade" id="quizzes" role="tabpanel">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-question-circle me-2"></i>Quizzes
                            </h5>
                        </div>
                        <div class="card-body">
    {% if quizzes %}
                                <div class="row">
        {% for quiz in quizzes %}
                                    <div class="col-md-6 col-lg-4 mb-4">
                                        <div class="card h-100">
                                            <div class="card-body">
                                                <h6 class="card-title">{{ quiz.title }}</h6>
                                                <p class="card-text small">{{ quiz.description[:100] if quiz.description else 'No description' }}{% if quiz.description and quiz.description|length > 100 %}...{% endif %}</p>
                                                
                                                <div class="mb-3">
                                                    {% if quiz.time_limit %}
                                                    <small class="text-muted d-block">
                                                        <i class="fas fa-clock me-1"></i>
                                                        Time Limit: {{ quiz.time_limit }} minutes
                                                    </small>
                                                    {% endif %}
                                                    {% if quiz.start_time %}
                                                    <small class="text-muted d-block">
                                                        <i class="fas fa-calendar me-1"></i>
                                                        Available: {{ quiz.start_time.strftime('%b %d, %Y') }}
                                                    </small>
                                                    {% endif %}
                                                    {% if quiz.end_time %}
                                                    <small class="text-muted d-block">
                                                        <i class="fas fa-calendar-times me-1"></i>
                                                        Ends: {{ quiz.end_time.strftime('%b %d, %Y') }}
                                                    </small>
                                                    {% endif %}
                                                </div>

                                                {% set submission = quiz.submissions|selectattr('student_id', 'equalto', current_user.id)|first %}
                                                {% if submission and submission.end_time %}
                                                    <div class="alert alert-success small">
                                                        <i class="fas fa-check-circle me-1"></i>
                                                        Completed - Score: {{ "%.1f"|format(submission.score) }}%
                                                    </div>
                                                    <div class="d-grid">
                                                        <a href="{{ url_for('student.quiz_result', course_id=course.id, quiz_id=quiz.id) }}" class="btn btn-outline-success btn-sm">
                                                            <i class="fas fa-eye me-1"></i>View Results
                                                        </a>
                                                    </div>
                                                {% elif quiz.start_time and current_time < quiz.start_time %}
                                                    <div class="alert alert-warning small">
                                                        <i class="fas fa-clock me-1"></i>
                                                        Not available yet
                                                    </div>
                                                    <div class="d-grid">
                                                        <button class="btn btn-secondary btn-sm" disabled>
                                                            <i class="fas fa-lock me-1"></i>Locked
                                                        </button>
                                                    </div>
                                                {% elif quiz.end_time and current_time > quiz.end_time %}
                                                    <div class="alert alert-danger small">
                                                        <i class="fas fa-times-circle me-1"></i>
                                                        Quiz expired
                                                    </div>
                                                    <div class="d-grid">
                                                        <button class="btn btn-secondary btn-sm" disabled>
                                                            <i class="fas fa-ban me-1"></i>Expired
                                                        </button>
                                                    </div>
            {% else %}
                                                    <div class="d-grid">
                                                        <a href="{{ url_for('student.take_quiz', course_id=course.id, quiz_id=quiz.id) }}" class="btn btn-primary btn-sm">
                                                            <i class="fas fa-play me-1"></i>Take Quiz
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="text-center py-5">
                                    <i class="fas fa-question-circle fa-3x text-muted mb-3"></i>
                                    <h5 class="text-muted">No quizzes available</h5>
                                    <p class="text-muted">Quizzes will be posted by your instructor.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Meetings Tab -->
        <div class="tab-pane fade" id="meetings" role="tabpanel">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-video me-2"></i>Meetings
                            </h5>
                        </div>
                        <div class="card-body">
                            {% if meetings %}
                                <div class="row">
                                    {% for meeting in meetings %}
                                    <div class="col-md-6 col-lg-4 mb-4">
                                        <div class="card h-100 border-{% if meeting.scheduled_time < current_time %}secondary{% else %}primary{% endif %}">
                                            <div class="card-body">
                                                <h6 class="card-title">{{ meeting.title }}</h6>
                                                <p class="card-text small">{{ meeting.description[:100] if meeting.description else 'No description' }}{% if meeting.description and meeting.description|length > 100 %}...{% endif %}</p>
                                                
                                                <div class="mb-3">
                                                    <small class="text-muted d-block">
                                                        <i class="fas fa-calendar me-1"></i>
                                                        {{ meeting.scheduled_time.strftime('%b %d, %Y at %I:%M %p') }}
                                                    </small>
                                                    <small class="text-{% if meeting.scheduled_time < current_time %}muted{% else %}success{% endif %} d-block">
                                                        <i class="fas fa-circle me-1"></i>
                                                        {% if meeting.scheduled_time < current_time %}Past Meeting{% else %}Upcoming Meeting{% endif %}
                                                    </small>
                                                </div>

                                                {% if meeting.meeting_link %}
                                                <div class="d-grid">
                                                    <a href="{{ meeting.meeting_link }}" target="_blank" class="btn btn-{% if meeting.scheduled_time < current_time %}outline-secondary{% else %}primary{% endif %} btn-sm">
                                                        <i class="fas fa-video me-1"></i>
                                                        {% if meeting.scheduled_time < current_time %}View Recording{% else %}Join Meeting{% endif %}
                                                    </a>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="text-center py-5">
                                    <i class="fas fa-video fa-3x text-muted mb-3"></i>
                                    <h5 class="text-muted">No meetings scheduled</h5>
                                    <p class="text-muted">Meetings will be scheduled by your instructor.</p>
                </div>
            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resources Tab -->
        <div class="tab-pane fade" id="resources" role="tabpanel">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-download me-2"></i>Course Resources
                            </h5>
                        </div>
                        <div class="card-body">
                            {% if attachments %}
                                <div class="row">
                                    {% for attachment in attachments %}
                                    <div class="col-md-6 col-lg-4 mb-4">
                                        <div class="card h-100">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center mb-3">
                                                    <i class="fas fa-file fa-2x text-primary me-3"></i>
                                                    <div>
                                                        <h6 class="card-title mb-1">{{ attachment.filename }}</h6>
                                                        <small class="text-muted">
                                                            Uploaded: {{ attachment.uploaded_at.strftime('%b %d, %Y') }}
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="d-grid">
                                                    <a href="{{ url_for('uploaded_file', filename=attachment.filename) }}" target="_blank" class="btn btn-outline-primary btn-sm">
                                                        <i class="fas fa-download me-1"></i>Download
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
        {% endfor %}
                                </div>
    {% else %}
                                <div class="text-center py-5">
                                    <i class="fas fa-download fa-3x text-muted mb-3"></i>
                                    <h5 class="text-muted">No resources available</h5>
                                    <p class="text-muted">Course materials will be uploaded by your instructor.</p>
                                </div>
    {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.nav-tabs .nav-link {
    border: none;
    border-bottom: 3px solid transparent;
    color: #6c757d;
    font-weight: 500;
}

.nav-tabs .nav-link.active {
    border-bottom-color: #667eea;
    color: #667eea;
    background: none;
}

.nav-tabs .nav-link:hover {
    border-bottom-color: #dee2e6;
    color: #495057;
}

.card {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    border: 1px solid rgba(0, 0, 0, 0.125);
}

.card-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid rgba(0, 0, 0, 0.125);
}

.progress {
    background-color: #e9ecef;
}

.accordion-button:not(.collapsed) {
    background-color: #f8f9fa;
    color: #495057;
}

.accordion-button:focus {
    box-shadow: none;
    border-color: rgba(0, 0, 0, 0.125);
}
</style>

<script>
// Auto-refresh course data every 30 seconds
setInterval(function() {
    // You can add AJAX calls here to refresh course data
    console.log('Refreshing course data...');
}, 30000);

// Add smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Initialize tooltips
var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
});
</script>
{% endblock %} 